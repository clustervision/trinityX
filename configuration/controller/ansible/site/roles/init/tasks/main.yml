---
# Initialize required variables

- name: Check if this node is the primary controller
  set_fact:
    primary: '{{ True if trix_ctrl1_ip in ansible_all_ipv4_addresses else False }}'
  tags:
    - init
    - always

- name: Add pacemaker resource group Trinity-stack
  pcs_resource:
    name: 'place_holder'
    resource_type: 'Dummy'
    options: 'op monitor interval=0 --group Trinity-stack'
    state: present
  when: primary == True and ha == True
  tags: pcs

- name: Add pacemaker colocation constraint
  pcs_constraint:
    constraint_type: 'colocation'
    resource1: 'Trinity-stack'
    resource2: 'Trinity'
    score: 'INFINITY'
    state: present
  when: primary == True and ha == True
  tags: pcs

- name: Add pacemaker order constraint
  pcs_constraint:
    constraint_type: 'order'
    resource1: 'Trinity-fs'
    resource2: 'Trinity-stack'
    score: 'INFINITY'
    state: present
  when: primary == True and ha == True
  tags: pcs
