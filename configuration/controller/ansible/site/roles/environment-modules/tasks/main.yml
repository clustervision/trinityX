---
# tasks file for environment-modules

# Contents of the shared modulefiles directory:
# /trinity/shared/
# `-- modulefiles
#     |-- cv-advanced       advanced CV modules, not available by default
#     Â¦-- cv-standard       standard CV modules, available by default
#     |-- site-local        site-local modules, available by default
#      -- modulegroups      modulefiles to load groups (advanced, local, etc)

- name: Create the shared modules directories
  file:
    dest: '{{ trix_shared }}/modulefiles/{{ item }}'
    owner: root
    group: root
    state: directory
  with_items:
    - 'modulegroups'
    - 'cv-standard'
    - 'cv-advanced'
    - 'site-local'
  when: primary == true
  tags: environment-modules

- name: Copy cv-advanced to shared modules location
  template:
    src: cv-advanced
    dest: '{{ trix_shared }}/modulefiles/modulegroups'
  when: primary == true
  tags: environment-modules

- name: Add the group paths to the default configuration
  lineinfile:
    path: '/usr/share/Modules/init/.modulespath'
    line: '{{ trix_shared }}/modulefiles{{ item }}'
  with_items:
    - '/modulegroups'
    - '/cv-standard'
    - '/site-local'
    - '' 
