---
- name: Install packages needed for trix_node_basic_data.sh
  yum:
    name: "{{ item }}"
    state: latest
  with_items:
  - kernel-tools
  - util-linux

- name: Put diagnosis script to /usr/local/libexec/trix_node_basic_info.sh
  copy:
    src: trix_node_basic_info.sh
    dest: /usr/local/libexec
    owner: "root"
    group: "root"
    mode: '0755'

- name: Add TrinityX branding in skel
  lineinfile:
    dest: /etc/skel/.bash_profile
    state: present
    line: echo "TrinityX on $(cat /etc/redhat-release)"

- name: Add TrinityX branding in .bash_profile for root
  blockinfile:
    path: /root/.bash_profile
    block: |
      echo "TrinityX on $(cat /etc/redhat-release)"
      /usr/local/libexec/trix_node_basic_info.sh

- name: Put osimage name in /root/osimage
  template:
    src: image.j2
    dest: /root/osimage
  when: ansible_connection == 'lchroot' and image_name is defined
