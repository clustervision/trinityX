---
# tasks file for environment-modules

# An example of the structure of shared modules:
# envmodules_files_path/
#  ├── groups
#  │   └── userspace
#  │       ├── all          - Loads all the installed versions
#  │       └── tr17.10      - Loads a particular version
#  └── tr17.10
#      └── x86_64
#          ├── compiler
#          │   ├── gcc
#          │   ├── python2
#          │   └── python3
#          └── libraries
#              └── intel-runtime

- name: Install environment-modules packages
  yum:
   name: '{{ item }}'
   state: present
  with_items: '{{ envmodules_packages }}'

- name: Add the group paths to the default configuration
  blockinfile:
    path: /usr/share/Modules/init/.modulespath
    block: |
      {% for dir in envmodules_files_subdirs -%} 
      {{ envmodules_files_path }}/{{ dir }}
      {% endfor %}
    state: present
