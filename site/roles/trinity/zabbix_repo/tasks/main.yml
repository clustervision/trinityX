---
# tasks for zabbix_agent role

- name: Download zabbix GPG key
  get_url:
    url: https://repo.zabbix.com/RPM-GPG-KEY-ZABBIX-A14FE591
    dest: /etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591

- name: Add zabbix repo key
  rpm_key:
    key: /etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591
    state: present

- name: Configure zabbix repos
  yum_repository:
    name: "{{ item.name }}"
    description: "{{ item.description }}"
    baseurl: "{{ item.baseurl }}"
    gpgcheck: "{{ item.gpgcheck | default('no') }}"
    gpgkey: "{{ item.gpgkey | default('') }}"
    enabled: "{{ item.enabled | default('yes') }}"
    reposdir: "{{ image_path }}/etc/yum.repos.d/"
  with_items: "{{ zabbix_repo_repos }}"
